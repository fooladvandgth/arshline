## v4.0.0 — پیام‌رسان کامل + منوی مستقل گروه‌ها

- تاریخ: 2025-09-29
- شاخه: feature/form-user-management
- نکات برجسته:
	- پیامک کامل: تب «پیامک» با ارسال گروهی، تست اتصال، تنظیمات ارائه‌دهنده (SMS.IR)، جایگزینی متغیرها (#name, #phone, #link) و اجباری بودن «لغو11» در انتهای پیام.
	- لینک شخصی هر عضو: تولید و تضمین توکن‌های اعضا؛ لینک‌های شخصی بر اساس فرم منتشرشده و گروه‌های متصل؛ ذخیره و ممیزی نتایج ارسال.
	- فیلتر فرم‌ها: در UI ارسال پیامک، فقط فرم‌های «منتشر شده» که به همهٔ گروه‌های انتخاب‌شده متصل‌اند نمایش داده می‌شوند؛ همگام‌سازی با پاسخ {group_ids}.
	- راهنمای متغیرها: نمایش پویا بر اساس اشتراک فیلدهای سفارشی گروه‌های انتخاب‌شده.
	- اشتراک‌گذاری فرم: ساخت توکن عمومی و نمایش فوری لینک در تب «ارسال/اشتراک‌گذاری» پس از انتشار.
	- منوی مستقل «گروه‌های کاربری»: افزودن آیتم مستقل در منوی مدیریت افزونه؛ حذف نیاز به دکمه زیر «کاربران». 

## v3.0.0 — پایدار: گروه‌های کاربری، صفحه‌بندی و UI منسجم

- تاریخ: 2025-09-29
- شاخه: feature/form-user-management
- نکات برجسته:
	- یکپارچه‌سازی کامل «گروه‌های کاربری» در داشبورد سفارشی: مسیرهای `#users/ug`, `#users/ug-members`, `#users/ug-fields`, `#users/ug-mapping` با تب‌ها و رندر تنبل باندل.
	- امنیت و جریان ایمپورت/اکسپورت: استفاده از Nonce برای REST و admin-post؛ بازگشت به پنل بعد از ایمپورت با `redirect_to` (بدون پرش به wp-admin).
	- CSV ایمپورت مقاوم: حذف BOM/کاراکترهای صفرعرض، تشخیص جداکننده (، ؛ \t)، نرمال‌سازی حروف فارسی/عربی و پذیرش کلیدهای همنام برای نام/تلفن.
	- صفحه‌بندی اعضا: API سمت سرور با پارامترهای `per_page/page/search` و پاسخ استاندارد `{items,total,page,per_page,total_pages}`؛ در UI کنترل‌های «اول/قبلی/بعدی/آخر»، جستجو و «در هر صفحه» اضافه شد.
	- UI/UX: فونت «وزیر» برای دکمه‌ها و ورودی‌ها، فاصله‌گذاری بهتر فرم فیلتر و ورودی‌های داخل جدول، خوانایی مناسب در دارک‌مود.
	- حذف اتکا به wp-admin برای مدیریت گروه‌ها (گیت ثبت منو غیرفعال به‌صورت پیش‌فرض)، ولی هندلرهای admin-post فعال هستند.

## v2.7.0 — پایدار: فرم سالم، هوشیار سالم، آغاز مسیر کاربران

	- فرم سالم: جلوگیری از فلش موقت UI در ادیتور؛ اسکَفولد خنثی برای ادیتور؛ رندر یک‌مرحله‌ای پیش‌نمایش/تنظیمات
	- درگ‌اَند‌دراپ پایدار: جابه‌جایی کارت‌ها با نشانه‌گر مستطیلی هم‌قد کارت مقصد؛ کشیدن ابزار از جعبه‌ابزار و بازشدن ادیتور همان‌جا
	- عملکرد: حذف فِچ تکراری در افزودن سؤال؛ یک‌باره‌سازی مقداردهی روتر؛ گارد fast-click با inFlight و navToken
	- هوشیار سالم: پیام‌های فارسی طبیعی، مسیرهای clarify/confirm/undo، و ثبت رخدادها فقط برای ادمین
	- امنیت/زیرساخت کاربران: آغاز پیاده‌سازی گروه‌ها و دسترسی‌های فرم؛ بررسی توکن عضویت در فرم‌های عمومی
	- Builder: محافظت در برابر رندرهای کهنه با navToken؛ جلوگیری از init مجدد روتر؛ dedupe دریافت فرم در افزودن
	- DnD: بازسازی حالات dragenter/dragover/drop، ghost image سفارشی، احترام به جایگاه «thank_you» در انتها
	- Console-capture: صف‌بندی غیرهمگام، sanitization، پیکربندی JSON امن از قالب داشبورد
- داشبورد: رفع مشکل عدم واکنش دکمه «گروه‌های کاربری»؛ پشتیبانی مسیریاب از مسیر تو درتو `#users/ug` حتی با پارامتر `?tab=` و اکسپوز تابع `renderUsersUG` برای فراخوانی مستقیم از Router. همچنین بهبود بارگذاری تنبل باندل مدیریت گروه‌ها با مسیر fallback مطمئن.

## v2.6.0 — هوشیار پایدار (Stable)؛ قابل استفاده و قابل تکمیل

- تاریخ: 2025-09-28
- شرح: عرضهٔ نسخهٔ پایدار اولیه از «هوشیار» با تمرکز بر تجربهٔ کاربری طبیعی، مسیرهای امن تایید/توضیح، و بازگردانی سروری. این نسخه قابل اتکا برای استفاده روزانه است و زیرساخت آن برای تکمیل قابلیت‌ها آماده است.
- نکات برجسته:
	- UI انسانی: خروجی‌های دوستانه فارسی در ترمینال؛ بدون JSON خام در UI؛ برچسب لاگ‌ها با [TODO_REMOVE_LOG]
	- تم تاریک: نوشته‌های خروجی ترمینال در حالت تاریک با سبز فسفری خوانا و glow
	- زبان طبیعی: پشتیبانی از عبارات محاوره‌ای ناوبری («برو فرم‌ها/بازش کن…») و ساخت فرم («فرم جدید/فرم جدید می‌خوام»)
	- مسیر امن: جریان‌های clarify/confirm برای انتخاب فرم و تایید عملیات تغییر‌دهنده
	- Undo/Audit: ثبت کامل عملیات و بازگشت‌پذیری با undo_token از سرور
	- افزودن فیلد: «سؤال پاسخ کوتاه اضافه کن» انتها اضافه می‌شود و مستقیماً ادیتور همان سوال باز می‌گردد
	- مسیریابی پایدار: باز کردن بیلدر/نتایج/ادیتور با setHash و فورس رندر جهت جلوگیری از تاخیر رندر
	- LLM هوشمند: در حالت AI کامل همیشه LLM؛ در هیبرید، فقط هنگام ابهام؛ ارسال زمینهٔ UI (tab/route) و لیست امکانات مرتبط به LLM
	- دسترس‌پذیری: بستن با ESC، inert هنگام بسته بودن، مدیریت فوکوس؛ هدر پنل با نشانگر grab/grabbing هنگام درگ

- موارد فنی:
	- Endpointها: /ai/agent، /ai/audit، /ai/undo با undo_token
	- Schema سفت‌وسخت JSON برای LLM و نگاشت عنوان→شناسه با fuzzy-match
	- تنظیمات: parser mode (internal|llm|hybrid) با پیش‌فرض هیبرید

- مسیرهای بعدی (قابل تکمیل):
	- افزودن انواع سوال بیشتر (long_text, multiple_choice, dropdown, rating)
	- حذف لاگ‌های [TODO_REMOVE_LOG] قبل از انتشار عمومی بعدی
	- غنی‌سازی دانش صفحه‌محور LLM و نمونه‌ها

## v2.5.2 — هوشیار: ادیت پرسش + برگشت/Undo + پایداری مسیریابی

- تاریخ: 2025-09-28
- شرح: گسترش قابلیت‌های هوشیار با فرمان‌های «پرسش N را ویرایش کن» (open_editor) و دستورات UI مانند «برگرد» و «undo»، به‌همراه پایداری کامل مسیریابی بیلدر/ادیتور (Route فورس بعد از setHash) و بهبود تنظیمات (پیش‌فرض‌سازی Parser روی حالت هیبریدی و پیش‌پر API Key).
- تغییرات کلیدی:
	- AI/Parser: حالت‌های internal/llm/hybrid (پیش‌فرض hybrid) با fallback امن LLM فقط-JSON؛ تحمل تایپو و افعال محاوره‌ای («وا کن/واکن»)
	- ادیت سؤال: intent «open_editor» با الگوهای «پرسش 1 را ویرایش کن [در فرم 24]» یا «ادیت پرسش 1»؛ پشتیبانی از index مستقیم و پرش از بیلدر به ادیتور
	- UI Commands: «undo» و «go_back» با استک UI و تکیه بر audit/undo سمت سرور در صورت نیاز
	- Routing: فراخوانی فوری routeFromHash/renderForm* پس از setHash برای builder/editor/results تا از عدم‌ابتکار رندر جلوگیری شود
	- Settings: پارسر پیش‌فرض «هیبریدی» در UI تنظیمات؛ پیش‌پر کردن API Key و دیگر فیلدها از /ai/config
	- اسناد: به‌روزرسانی AI_CAPABILITIES با نمونه‌های فارسی جدید

## v2.5.1 — هوشیار: اقدامات سروری + Audit/Undo + تأیید/توضیح

- تاریخ: 2025-09-28
- شرح: معرفی سیستم لاگ‌گیری و بازگردانی (Audit/Undo) برای عملیات تغییر حالت و متادیتای فرم؛ افزودن جریان‌های clarify/confirm برای اطمینان از انتخاب و تایید کاربر؛ مقادیر undo_token برای همهٔ عملیات تغییردهنده بازگردانده می‌شود.
- تغییرات کلیدی:
	- Server-backed Actions: open_form/close_form/draft_form/update_form_title با audit و undo_token
	- Clarify/Confirm: رفع ابهام در انتخاب فرم براساس عنوان با fuzzy matching و تایید قبل از عملیات مخرب/ذخیره‌ای
	- Navigation Intents: باز کردن بیلدر/نتایج بر اساس ID یا عنوان (با تطبیق خطاهای املایی رایج)

## v2.5.0 — داشبورد ماژولار + مسیریاب مرکزی (Stable)

- تاریخ: 2025-09-28
- شرح: پایدارترین و کامل‌ترین نسخه‌ی افزونه تا امروز؛ ماژولارسازی کنترلر داشبورد، افزودن روتر مرکزی، اتصال کامل منوی سایدبار به مسیریابی (رفع قفل روی داشبورد)، و پاک‌سازی هد قالب با اتکای کامل به enqueue. FULL mode برای کنترلر خارجی فعال شد و بلاک اینلاین صرفاً نقش فallback دارد.
- تغییرات کلیدی:
	- Router: `assets/js/core/router.js` با APIهای setHash/routeFromHash/arRenderTab/setActive/init و جلوگیری از دوباره‌اجرایی
	- Controller: `assets/js/dashboard-controller.js` مالک `renderTab`، اتصال به روتر، اکسپورت توابع builder/editor/preview/results و اجتناب از bindهای مضاعف
	- Sidebar: hrefهای `#dashboard/#forms/#reports/#users/#settings` + کلیک‌هندلر برای setHash و رندر تب؛ هایلایت آیتم فعال
	- Template: فعال‌سازی FULL mode و عبور از کنترلر اینلاین در حضور کنترلر خارجی؛ ساده‌سازی head و بارگذاری ماژول‌ها
	- UI/UX: فونت Vazir، تم تاریک پایدار، بهبود کارت‌های KPI و دونات، حفظ انتخاب‌ها در localStorage
- سازگاری: مسیریابی سازگار با hash و دکمه‌های Back/Forward؛ لینک‌های عمیق (builder/editor/preview/results) از طریق hash

## v2.0.2 — پایدار ، فرم و گزارش سالم (Re-release)

- تاریخ: 2025-09-26
- شرح: بازانتشار فنی برای ایجاد خودکار GitHub Release از طریق CI (بدون تغییر کد نسبت به 2.0.1). عنوان و یادداشت‌ها از فایل release برداشت می‌شوند و بستهٔ ZIP افزونه به‌طور خودکار پیوست می‌گردد.
- نکته: اگر نسخهٔ 2.0.1 را نصب کرده‌اید، نیازی به به‌روزرسانی نیست؛ این نسخه صرفاً برای هم‌ترازی فرآیند انتشار است.

## v2.0.1 — پایدار ، فرم و گزارش سالم

- تاریخ: 2025-09-26
- شرح: انتشار پایدار با فرم عمومی سالم و گزارش نتایج بدون خطا. خروجی‌های CSV/Excel به‌صورت UTF‑8 واقعی (بدون JSON-escape)، دکمه‌های خروجی کنار فیلترهای هر سؤال، حذف ستون‌های ناخواسته و بهبود تجربهٔ جدول نتایج (خطوط شبکه، جابه‌جایی ستون‌ها، و wrap/nowrap).
- تغییرات کلیدی:
	- اکسپورت: استریم مستقیم CSV/Excel از API (headers درست + BOM)؛ حذف ستون summary؛ احترام به فیلترها و بی‌اعتنایی به صفحه‌بندی
	- UI نتایج: خطوط شبکه واضح، حذف کنترل چگالی، تاگل wrap/nowrap، درگ‌اندرآپ ستون‌ها با ماندگاری
	- اشکال‌زدایی: فعال‌سازی لاگ‌ها با ?arshdbg=1 و نمایش خطاها در کنسول حتی بدون دیباگ
	- پایداری: فیلترکردن فیلدهای غیرپاسخی از جدول و خروجی‌ها؛ رفع حلقهٔ رندر بی‌نهایت در مرتب‌سازی ستون‌ها

## v1.7.2 — نسخه پایدار فرم عمومی + اعتبارسنجی + چاپ

- تاریخ: 2025-09-26
- شرح: انتشار نسخهٔ پایدار با رندر صحیح فرم‌های عمومی (ID/توکن)، اعتبارسنجی کامل سمت سرور و کلاینت، پاسخ HTMX بدون JSON-escape، صفحهٔ چاپ «مشاهده فرم» با خروجی CSV/Excel و نمایش غنی متن، و فونت فارسی Vazirmatn.
- تغییرات کلیدی:
	- رندر عمومی: هموارسازی فیلدها (id/sort + props)، فیلتر نوع‌های پشتیبانی‌شده، شماره‌گذاری صحیح، ارسال payload درست
	- HTMX: نمایش مستقیم HTML (rest_pre_serve_request)، اختیاری بودن HTMX per-form، نمایش هشدار روی صفحه
	- اعتبارسنجی: تطبیق با field_id در سرور، پیام‌های دقیق 422؛ سمت کلاینت پیام زیر هر سوال، اسکرول/فوکوس به اولین خطا، بررسی لحظه‌ای (blur/input/change)، حرکت با Enter به سوال بعدی
	- داشبورد: بارگذاری لیست پاسخ‌ها با nonce و credentials
	- چاپ: صفحهٔ مستقل «مشاهده فرم» با فونت فارسی، خروجی CSV/Excel، رندر امن متن غنی (b/i/u/p/ul/ol/li/a/span[color])
	- تایپوگرافی: استفاده از فونت فارسی Vazirmatn در فرم عمومی و صفحه چاپ

---

## v_restore_20250924


توضیحات بازگردانی:


تست‌های محلی انجام‌شده توسط کاربر:


نکات عملیاتی:

## v1.5 - بازگشت پشتیبانی از متن بلند (Release)

- تاریخ: 2025-10-02
- شرح: بازگردانی و بهبود پشتیبانی از فیلدهای متن بلند (textarea)، گزینه‌های پیشرفته برای فیلدهای بلند و کوتاه، افزودن آپلود تصویر برای فیلدها (JPG/PNG، حداکثر 300KB)، و رفع چندین خطای جاوااسکریپت در داشبورد.
- شاخه: `stable/restore-20250924`
- یادداشت: این نسخه با هدف بازگردانی رفتار قبلی و پایدارسازی سازندهٔ فرم منتشر می‌شود.

## v1.5.1 - نسخهٔ پایدار بدون ایراد تا متن طولانی

- تاریخ: 2025-09-25
- شرح: رفع فلش موقت GUI هنگام باز کردن ویرایشگر متن طولانی، افزودن کنترل آپلود تصویر/ویدئو در تنظیمات فیلد (پیش‌نمایش با اندازهٔ محدود 200×200)، و قابلیت capture کنسول برای اشکال‌زدایی‌های بعدی.
- شاخه: `stable/restore-20250924`

## v1.5.2 — بازگردانی پایدار «چندگزینه‌ای» و هم‌سوسازی با GitHub

- تاریخ: 2025-09-25
- شرح: بازگردانی نسخه‌ی پایدار ادیتور/پیش‌نمایش چندگزینه‌ای از کامیت تست‌شده (95260c7) و مرج روی master؛ هم‌سوسازی کامل ورک‌اسپیس با origin/master؛ پاک‌سازی جزئی و یکپارچه‌سازی نسخه‌ها.
- تغییرات کلیدی:
	- ادیتور چندگزینه‌ای: ردیف‌های گزینه با +/− و درگ‌هندل، برچسب دوم، همگام‌سازی زنده با پیش‌نمایش
	- پیش‌نمایش چندگزینه‌ای: چینش عمودی/افقی، تک/چند انتخابی، تصادفی‌سازی
	- رندر textarea برای متن بلند در پیش‌نمایش
	- درگ‌دراپ: پذیرش short_text، long_text، multiple_choice در بوم
	- لاگ‌های اشکال‌زدایی: فعال‌سازی با localStorage.arshDebug=1
- نسخه‌ها:
	- افزونه: 1.5.2
	- داشبورد: 1.5.2

## v1.5.3 — هات‌فیکس سیاست «فقط تصویر» و پایداری

- تاریخ: 2025-09-25
- شرح: حذف کامل مسیرهای ویدئو از ادیتور/پیش‌نمایش متن‌بلند و پیش‌فرض‌سازی «آپلود رسانه» روی خاموش (media_upload=false) برای متن‌بلند، جهت انطباق با سیاست فقط-عکس و جلوگیری از رفتارهای ناخواسته.
- تغییرات کلیدی:
	- حذف ورودی/پیش‌نمایش/منطق ویدئو در متن‌بلند (فقط تصویر مجاز است)
	- پیش‌فرض متن‌بلند: media_upload=false (در افزودن و دراپ)
	- پاک‌سازی حداقلی بدون تغییر در سایر ابزارها (چندگزینه‌ای بدون تغییر)
- نسخه‌ها:
	- افزونه: 1.5.3
	- داشبورد: 1.5.3

## v1.6.0 — ماژولارسازی ابزارها و یکپارچه‌سازی پیش‌فرض‌ها

- تاریخ: 2025-09-25
- شرح: شروع ماژولارسازی ویراستار فیلدها و استخراج منطق ابزارها به ماژول‌های جداگانه برای نگهداشت بهتر و کاهش رگرسیون‌ها. اضافه‌شدن رجیستری مرکزی ARSH.Tools با توابع register/get/getDefaults و hookهای renderEditor/renderPreview. هم‌راستاسازی پیش‌فرض‌ها (از جمله media_upload=false برای متن‌بلند) در یک محل واحد.
- تغییرات کلیدی:
	- رجیستری مرکزی ابزارها: ARSH.Tools (defaults + رندر سفارشی)
	- ماژول‌ها: assets/js/tools/short_text.js، long_text.js، multiple_choice.js
	- dashboard-template.php: تلاش برای رندر از طریق ماژول‌ها، با fallback به رندر داخلی در صورت نبود ماژول
	- حفظ سیاست رسانه: فقط تصویر (JPG/PNG ≤ 300KB)؛ بدون ویدئو؛ پیش‌فرض آپلود رسانه خاموش در متن‌بلند
	- بهبود ناوبری ادیتور: بازگشت به سازنده فرم پس از ذخیره (در ماژول‌ها)
- نسخه‌ها:
	- افزونه: 1.6.0
	- داشبورد: 1.6.0

## v1.6.1 — هات‌فیکس بازگشت پس از ذخیره (Stable)

- تاریخ: 2025-09-25
- شرح: تضمین بازگشت خودکار به فرم‌ساز بعد از «ذخیره شد» حتی در صورت عدم فراخوانی بازگشت توسط ماژول ابزار. اکسپورت سراسری توابع ناوبری برای سازگاری بهتر با ماژول‌ها.
- تغییرات کلیدی:
	- saveFields: پس از موفقیت ذخیره، فراخوانی مستقیم renderFormBuilder(id)
	- window.*: در دسترس قرار دادن renderFormBuilder / renderFormEditor / renderFormPreview روی window
- نسخه‌ها:
	- افزونه: 1.6.1
	- داشبورد: 1.6.1

	## v1.7.0 — پایان فاز اول ابزارها (Stable)

	- تاریخ: 2025-09-26
	- شرح: تکمیل فاز اول ابزارها شامل ابزارهای Dropdown و Rating، یکپارچه‌سازی تاگل‌ها، آیکون‌های اختصاصی و بهبودهای UX در سازندهٔ فرم.
	- تغییرات کلیدی:
		- ابزار Dropdown با پیش‌نمایش تعاملی و تنظیمات مرتب‌سازی (الفبایی/تصادفی‌سازی با انحصار متقابل)
		- ابزار Rating با ۱–۲۰ آیکون و ۶ نوع آیکون (ستاره، قلب، تایید، مدال، لبخند، ناراحت) و پالت انتخاب آیکون
		- استانداردسازی toggle-switch در همه ابزارها
		- بهبود شماره‌گذاری سوالات و آیکون‌های جعبه‌ابزار
	- نسخه‌ها:
		- افزونه: 1.7.0
		- داشبورد: 1.7.0
