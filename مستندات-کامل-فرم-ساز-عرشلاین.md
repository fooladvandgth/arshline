# 🚀 مستندات کامل فرم‌ساز عرشلاین (ARSHLINE)
**نسخه: 6.4.5 | تاریخ تحلیل: ۱۱ دی ۱۴۰۳**

---

## 📋 فهرست مطالب

1. [معرفی کلی](#معرفی-کلی)
2. [ویژگی‌های اصلی](#ویژگی-های-اصلی)
3. [معماری و ساختار](#معماری-و-ساختار)
4. [انواع فیلدهای فرم](#انواع-فیلدهای-فرم)
5. [سیستم داشبورد](#سیستم-داشبورد)
6. [قابلیت‌های هوش مصنوعی](#قابلیت-های-هوش-مصنوعی)
7. [مدیریت گروه‌های کاربری](#مدیریت-گروه-های-کاربری)
8. [API و توسعه](#api-و-توسعه)
9. [امنیت و کنترل دسترسی](#امنیت-و-کنترل-دسترسی)
10. [تنظیمات و پیکربندی](#تنظیمات-و-پیکربندی)

---

## 🔍 معرفی کلی

**فرم‌ساز عرشلاین** یک افزونه پیشرفته و کامل برای وردپرس است که امکان ساخت فرم‌های تعاملی با هوش مصنوعی، داشبورد اختصاصی، و قابلیت‌های تحلیلی را فراهم می‌کند.

### ✨ نقاط قوت کلیدی:
- **فرم‌ساز درگ و دراپ** با پیش‌نمایش زنده
- **هوش مصنوعی هوشیار** برای تحلیل و مدیریت
- **داشبورد اختصاصی** مستقل از وردپرس
- **اعتبارسنجی پیشرفته** برای انواع داده‌های فارسی
- **مدیریت گروه‌های کاربری** با لینک‌های شخصی‌سازی شده
- **REST API کامل** برای توسعه‌دهندگان

---

## 🏗️ ویژگی‌های اصلی

### 🎯 فرم‌ساز پیشرفته

#### ساخت فرم:
- **درگ و دراپ** با SortableJS
- **پیش‌نمایش زنده** در حین ویرایش
- **ویرایشگر Rich Text** برای سؤالات
- **آپلود رسانه** (عکس/ویدیو) در فیلدها
- **پیام‌های خوش‌آمد و تشکر** قابل تنظیم

#### مدیریت فرم:
- **وضعیت‌های مختلف**: پیش‌نویس، منتشر شده، بسته شده
- **لینک‌های عمومی** برای اشتراک‌گذاری
- **توکن‌های کوتاه** برای دسترسی آسان
- **تکرار فرم** برای ساخت سریع

### 📊 داشبورد تحلیلی

#### نمایش اطلاعات:
- **آمار کلی** فرم‌ها و ارسال‌ها
- **نمودارهای تعاملی** با Chart.js
- **فیلترهای پیشرفته** برای جستجو
- **خروجی CSV/Excel** از داده‌ها

#### مدیریت ارسال‌ها:
- **مشاهده تک به تک** پاسخ‌ها
- **تغییر وضعیت** (در انتظار، تأیید شده، رد شده)
- **حذف گروهی** ارسال‌ها
- **چاپ و خروجی PDF** پاسخ‌ها

---

## 🏛️ معماری و ساختار

### ساختار پروژه:
```
arshline/
├── arshline.php              # فایل اصلی افزونه
├── src/
│   ├── Core/                 # هسته سیستم
│   │   ├── Api.php           # REST API endpoints
│   │   ├── AccessControl.php # کنترل دسترسی
│   │   ├── FeatureFlags.php  # مدیریت ویژگی‌ها
│   │   └── Ai/               # سیستم هوش مصنوعی
│   │       ├── Hoshyar.php   # موتور اصلی AI
│   │       ├── Capabilities.php
│   │       ├── PlanExecutor.php
│   │       └── PlanValidator.php
│   ├── Dashboard/            # داشبورد اختصاصی
│   │   ├── Dashboard.php
│   │   └── dashboard-template.php
│   ├── Database/             # مایگریشن‌ها
│   │   └── Migrations.php
│   ├── Modules/              # ماژول‌های اصلی
│   │   ├── Forms/            # مدیریت فرم‌ها
│   │   └── UserGroups/       # گروه‌های کاربری
│   ├── Frontend/             # نمایش عمومی
│   │   └── form-template.php
│   └── Support/              # کلاس‌های کمکی
└── assets/
    ├── css/                  # استایل‌ها
    └── js/                   # جاوااسکریپت‌ها
```

### جداول دیتابیس:

#### `wp_x_forms` - فرم‌ها
```sql
CREATE TABLE wp_x_forms (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    schema_version VARCHAR(20) NOT NULL,
    owner_id BIGINT UNSIGNED,
    status VARCHAR(20) DEFAULT 'draft',
    public_token VARCHAR(24) NULL,
    meta JSON NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY public_token_unique (public_token)
);
```

#### `wp_x_fields` - فیلدهای فرم
```sql
CREATE TABLE wp_x_fields (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    form_id BIGINT UNSIGNED NOT NULL,
    sort INT UNSIGNED DEFAULT 0,
    props JSON NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (form_id) REFERENCES wp_x_forms(id) ON DELETE CASCADE
);
```

#### `wp_x_submissions` - ارسال‌ها
```sql
CREATE TABLE wp_x_submissions (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    form_id BIGINT UNSIGNED NOT NULL,
    user_id BIGINT UNSIGNED NULL,
    ip VARCHAR(45) NULL,
    status VARCHAR(20) DEFAULT 'pending',
    meta JSON NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (form_id) REFERENCES wp_x_forms(id) ON DELETE CASCADE
);
```

#### `wp_x_submission_values` - مقادیر ارسال‌شده
```sql
CREATE TABLE wp_x_submission_values (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    submission_id BIGINT UNSIGNED NOT NULL,
    field_id BIGINT UNSIGNED NOT NULL,
    value TEXT,
    idx INT UNSIGNED DEFAULT 0,
    FOREIGN KEY (submission_id) REFERENCES wp_x_submissions(id) ON DELETE CASCADE,
    FOREIGN KEY (field_id) REFERENCES wp_x_fields(id) ON DELETE CASCADE
);
```

---

## 📝 انواع فیلدهای فرم

### 1️⃣ پاسخ کوتاه (Short Text)

#### انواع اعتبارسنجی:
- **متن آزاد** (`free_text`): هیچ محدودیتی
- **ایمیل** (`email`): فرمت ایمیل معتبر
- **عدد** (`numeric`): فقط اعداد
- **موبایل ایران** (`mobile_ir`): 09xxxxxxxxx
- **موبایل بین‌المللی** (`mobile_intl`): +14155552671
- **کد ملی ایران** (`national_id_ir`): 10 رقم با الگوریتم تأیید
- **کد پستی ایران** (`postal_code_ir`): 10 رقم
- **تلفن** (`tel`): شماره تلفن ثابت
- **حروف فارسی** (`fa_letters`): فقط حروف فارسی و فاصله
- **حروف انگلیسی** (`en_letters`): فقط حروف انگلیسی و فاصله
- **آدرس IP** (`ip`): فرمت IPv4
- **زمان** (`time`): فرمت HH:MM
- **تاریخ شمسی** (`date_jalali`): yyyy/mm/dd
- **تاریخ میلادی** (`date_greg`): yyyy-mm-dd

#### تنظیمات قابل تنظیم:
- **سؤال**: متن سؤال با امکان فرمت‌دهی (Bold, Italic, رنگ)
- **الزامی بودن**: آیا پاسخ اجباری است؟
- **شماره‌گذاری**: نمایش شماره سؤال
- **توضیحات**: متن راهنما زیر سؤال
- **Placeholder**: متن راهنما داخل فیلد
- **حداقل/حداکثر طول**: محدودیت تعداد کاراکتر

### 2️⃣ پاسخ طولانی (Long Text)

#### ویژگی‌ها:
- **Textarea** چندخطی
- **تمام انواع اعتبارسنجی** مشابه پاسخ کوتاه
- **آپلود رسانه**: امکان آپلود عکس/ویدیو همراه متن
- **محدودیت طول**: تا 5000 کاراکتر

#### تنظیمات اضافی:
- **آپلود رسانه**: فعال/غیرفعال
- **حداقل طول**: حداقل تعداد کاراکتر
- **حداکثر طول**: حداکثر تعداد کاراکتر (پیش‌فرض: 5000)

### 3️⃣ سؤال چندگزینه‌ای (Multiple Choice)

#### انواع نمایش:
- **رادیو باتن** (تک انتخابی)
- **چک باکس** (چند انتخابی)
- **عمودی/افقی**: چیدمان گزینه‌ها

#### ویژگی‌های گزینه‌ها:
- **برچسب اصلی**: متن گزینه
- **مقدار**: مقدار ذخیره شده
- **برچسب ثانویه**: توضیح اضافی
- **رسانه**: عکس یا ویدیو برای گزینه

#### تنظیمات:
- **چندانتخابی**: امکان انتخاب چند گزینه
- **تصادفی‌سازی**: ترتیب تصادفی گزینه‌ها
- **الزامی**: حداقل یک گزینه باید انتخاب شود

---

## 🎛️ سیستم داشبورد

### تب‌های اصلی:

#### 📊 داشبورد (Dashboard)
- **آمار کلی**: تعداد فرم‌ها، ارسال‌ها، بازدیدها
- **نمودار فعالیت**: ارسال‌های روزانه/هفتگی/ماهانه
- **فرم‌های پربازدید**: رتبه‌بندی براساس تعداد ارسال
- **وضعیت سیستم**: بررسی سلامت افزونه

#### 📝 فرم‌ها (Forms)
- **لیست فرم‌ها**: نمایش جدولی با فیلتر و جستجو
- **ایجاد فرم جدید**: ویزارد ساخت فرم
- **ویرایش فرم**: ویرایشگر درگ و دراپ
- **پیش‌نمایش**: نمایش فرم قبل از انتشار
- **تنظیمات فرم**: عنوان، وضعیت، پیام‌ها

##### عملیات فرم:
- **کپی فرم**: تکرار فرم موجود
- **تغییر وضعیت**: پیش‌نویس → منتشر → بسته
- **لینک عمومی**: `/?arshline_form=ID`
- **توکن کوتاه**: `/?arshline=TOKEN`
- **خروجی CSV**: دانلود داده‌های فرم

#### 📊 گزارشات (Reports)
- **آمار تفصیلی**: گزارش‌های عمیق از هر فرم
- **نمودارهای تحلیلی**: میله‌ای، دایره‌ای، خطی
- **فیلتر زمانی**: گزارش براساس بازه زمانی
- **مقایسه فرم‌ها**: مقایسه عملکرد چند فرم

#### 👥 کاربران (Users)
- **مدیریت دسترسی**: تعیین سطح دسترسی کاربران
- **گروه‌های کاربری**: ایجاد و مدیریت گروه‌ها
- **لاگ فعالیت**: پیگیری اقدامات کاربران

#### ⚙️ تنظیمات (Settings)
- **تنظیمات عمومی**: پیکربندی پایه افزونه
- **تنظیمات ایمیل**: پیکربندی اطلاع‌رسانی
- **تنظیمات هوش مصنوعی**: پیکربندی AI
- **تنظیمات امنیتی**: کنترل دسترسی و محدودیت‌ها

---

## 🤖 قابلیت‌های هوش مصنوعی

### سیستم هوشیار (Hoshyar)

#### معماری AI:
```
هوشیار (Hoshyar)
├── موتور تفسیر دستورات
├── پردازش زبان طبیعی فارسی  
├── اجرای برنامه‌ریزی شده
└── تأیید و امنیت
```

#### قابلیت‌های دستوری:

##### 🧭 ناوبری:
- `"داشبورد را باز کن"` → باز کردن تب داشبورد
- `"فرم‌ها را نشان بده"` → رفتن به تب فرم‌ها
- `"گزارشات را باز کن"` → باز کردن تب گزارشات
- `"تنظیمات را نمایش بده"` → رفتن به تنظیمات

##### 📝 مدیریت فرم:
- `"فرم جدید بساز"` → ایجاد فرم جدید
- `"فرم 5 را حذف کن"` → حذف فرم شماره 5
- `"فرم 3 را فعال کن"` → انتشار فرم
- `"فرم 8 را غیرفعال کن"` → بستن فرم
- `"عنوان فرم 2 را تغییر بده"` → ویرایش عنوان

##### 🔧 تنظیمات:
- `"حالت تاریک را فعال کن"` → تغییر تم
- `"مدل را روی GPT-4 بگذار"` → تغییر مدل AI

#### مدل‌های پشتیبانی شده:
- **GPT-4o**: قدرتمندترین مدل ($2.50/1M token)
- **GPT-4o-mini**: متعادل و اقتصادی ($0.15/1M token)
- **GPT-3.5-turbo**: سریع و ارزان ($0.50/1M token)
- **انتخاب هوشمند**: انتخاب خودکار بهترین مدل

#### ویژگی‌های پیشرفته:
- **تأیید عملیات**: درخواست تأیید برای تغییرات مهم
- **Undo/Redo**: بازگردانی عملیات انجام شده
- **لاگ فعالیت**: ثبت تمام دستورات و نتایج
- **تحلیل داده**: پاسخ به پرسش‌های تحلیلی درباره داده‌ها

### تنظیمات هوش مصنوعی:

#### پیکربندی اتصال:
- **Base URL**: آدرس API (پیش‌فرض: OpenAI)
- **API Key**: کلید احراز هویت
- **Model**: انتخاب مدل پیش‌فرض
- **Mode**: حالت عملکرد (auto/manual)

#### تست اتصال:
- **دکمه تست**: بررسی فوری ارتباط با API
- **نمایش خطا**: راهنمایی برای رفع مشکلات
- **آمار مصرف**: نمایش میزان مصرف توکن

---

## 👥 مدیریت گروه‌های کاربری

### ساختار گروه‌های کاربری:

#### جدول `wp_x_user_groups`:
```sql
CREATE TABLE wp_x_user_groups (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(190) NOT NULL,
    parent_id BIGINT UNSIGNED NULL,
    meta JSON NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY group_name_unique (name)
);
```

#### جدول `wp_x_user_group_members`:
```sql
CREATE TABLE wp_x_user_group_members (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    group_id BIGINT UNSIGNED NOT NULL,
    name VARCHAR(190) NOT NULL,
    phone VARCHAR(32) NOT NULL,
    data JSON NULL,
    token VARCHAR(64) NULL,
    token_hash CHAR(64) NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### قابلیت‌ها:

#### ایجاد و مدیریت گروه‌ها:
- **گروه‌های سلسله‌مراتبی**: امکان زیرگروه
- **فیلدهای سفارشی**: تعریف متغیرهای اضافی
- **دسترسی به فرم**: تعیین کدام گروه به کدام فرم دسترسی دارد

#### مدیریت اعضا:
- **افزودن دستی**: ثبت تک به تک اعضا
- **ورود گروهی**: آپلود فایل CSV
- **توکن شخصی**: لینک اختصاصی برای هر عضو
- **فیلدهای اضافی**: ذخیره اطلاعات تکمیلی

#### لینک‌های شخصی‌سازی شده:
```
https://example.com/?arshline=ABC123XYZ
```
- **توکن منحصربه‌فرد**: برای هر عضو
- **ردیابی**: پیگیری پاسخ‌دهنده
- **محدودیت دسترسی**: فقط اعضای مجاز

---

## 🔌 API و توسعه

### REST API Endpoints:

#### فرم‌ها:
```http
GET    /wp-json/arshline/v1/forms
POST   /wp-json/arshline/v1/forms
GET    /wp-json/arshline/v1/forms/{id}
PUT    /wp-json/arshline/v1/forms/{id}
DELETE /wp-json/arshline/v1/forms/{id}
```

#### ارسال‌ها:
```http
GET    /wp-json/arshline/v1/submissions
POST   /wp-json/arshline/v1/submissions
GET    /wp-json/arshline/v1/submissions/{id}
PUT    /wp-json/arshline/v1/submissions/{id}
DELETE /wp-json/arshline/v1/submissions/{id}
```

#### گروه‌های کاربری:
```http
GET    /wp-json/arshline/v1/user-groups
POST   /wp-json/arshline/v1/user-groups
PUT    /wp-json/arshline/v1/user-groups/{id}
DELETE /wp-json/arshline/v1/user-groups/{id}
GET    /wp-json/arshline/v1/user-groups/{id}/members
POST   /wp-json/arshline/v1/user-groups/{id}/members
```

#### هوش مصنوعی:
```http
POST   /wp-json/arshline/v1/ai/agent
GET    /wp-json/arshline/v1/ai/config
PUT    /wp-json/arshline/v1/ai/config
POST   /wp-json/arshline/v1/analytics/analyze
```

### Hook های توسعه‌دهنده:

#### Actions:
```php
// قبل از ذخیره فرم
do_action('arshline_before_save_form', $form);

// بعد از ذخیره فرم  
do_action('arshline_after_save_form', $form_id, $form);

// قبل از ارسال
do_action('arshline_before_submission', $submission);

// بعد از ارسال
do_action('arshline_after_submission', $submission_id, $submission);
```

#### Filters:
```php
// اعتبارسنجی سفارشی
add_filter('arshline_validate_field', function($errors, $field, $value) {
    // اعتبارسنجی سفارشی
    return $errors;
}, 10, 3);

// تغییر نمایش فرم
add_filter('arshline_render_field', function($html, $field, $props) {
    // تغییر HTML فیلد
    return $html;
}, 10, 3);
```

---

## 🔒 امنیت و کنترل دسترسی

### سیستم احراز هویت:

#### سطوح دسترسی:
- **مدیر کل** (`manage_options`): دسترسی کامل
- **ویرایشگر** (`edit_posts`): مدیریت فرم‌ها و ارسال‌ها
- **مؤلف** (`publish_posts`): ایجاد و ویرایش فرم‌های خود
- **مشترک** (`read`): مشاهده فرم‌ها فقط

#### ویژگی‌های امنیتی:
- **WordPress Nonce**: محافظت در برابر CSRF
- **Rate Limiting**: محدودیت تعداد درخواست
- **IP Filtering**: فیلتر کردن IP های مشکوک
- **Data Sanitization**: پاکسازی ورودی‌های کاربر
- **SQL Injection Prevention**: استفاده از Prepared Statements

### کنترل دسترسی فرم‌ها:
```php
class AccessControl {
    public static function can_edit_form($form_id, $user_id = null) {
        // بررسی دسترسی ویرایش فرم
    }
    
    public static function can_view_submissions($form_id, $user_id = null) {
        // بررسی دسترسی مشاهده ارسال‌ها
    }
}
```

---

## ⚙️ تنظیمات و پیکربندی

### تنظیمات عمومی:

#### داشبورد:
- **صفحه داشبورد**: انتخاب صفحه نمایش داشبورد
- **تم پیش‌فرض**: روشن/تاریک
- **زبان داشبورد**: فارسی/انگلیسی
- **منطقه زمانی**: تنظیم منطقه زمانی

#### ایمیل:
- **اطلاع‌رسانی ارسال**: ایمیل بعد از هر ارسال
- **گزارش روزانه**: خلاصه فعالیت‌های روز
- **آدرس فرستنده**: ایمیل پیش‌فرض ارسال
- **قالب ایمیل**: سفارشی‌سازی متن ایمیل‌ها

#### فرم‌ها:
- **پیش‌فرض وضعیت**: وضعیت اولیه فرم‌های جدید
- **حداکثر آپلود**: سایز فایل‌های آپلودی
- **فرمت‌های مجاز**: انواع فایل قابل آپلود
- **مدت نگهداری**: زمان حذف خودکار ارسال‌ها

### تنظیمات هوش مصنوعی:

#### اتصال:
- **ارائه‌دهنده**: OpenAI, Azure OpenAI, سفارشی
- **Base URL**: آدرس پایه API
- **API Key**: کلید احراز هویت
- **Timeout**: زمان انتظار پاسخ

#### مدل‌ها:
- **مدل پیش‌فرض**: مدل اصلی
- **مدل بازخوانی**: مدل جایگزین در صورت خطا  
- **حداکثر توکن**: محدودیت طول پاسخ
- **Temperature**: میزان خلاقیت پاسخ (0-1)

#### محدودیت‌ها:
- **روزانه**: حداکثر درخواست در روز
- **کاربر**: حداکثر درخواست هر کاربر
- **هزینه**: سقف هزینه ماهانه
- **لاگ**: ثبت تمام درخواست‌ها

---

## 🚀 راهنمای استفاده سریع

### ساخت اولین فرم:

1. **ورود به داشبورد**: `your-site.com/arshline-dashboard`
2. **کلیک روی "فرم‌ها"** در منوی کناری
3. **"ایجاد فرم جدید"** → انتخاب عنوان
4. **افزودن فیلدها**: درگ از منوی ابزار
5. **تنظیم فیلدها**: کلیک برای ویرایش
6. **پیش‌نمایش**: بررسی نهایی فرم
7. **انتشار**: تغییر وضعیت به "منتشر شده"

### استفاده از هوش مصنوعی:

1. **فعال‌سازی AI**: تنظیمات → هوش مصنوعی
2. **وارد کردن API Key**: کلید OpenAI
3. **تست اتصال**: بررسی ارتباط
4. **باز کردن ترمینال**: کلیک روی آیکون ربات
5. **دستور فارسی**: "فرم جدید با عنوان نظرسنجی بساز"
6. **تأیید**: موافقت با عملیات پیشنهادی

### ایجاد گروه کاربری:

1. **گروه‌های کاربری** در منوی اصلی
2. **ایجاد گروه جدید** → نام گروه
3. **افزودن اعضا** → نام و شماره تلفن
4. **تولید توکن** برای هر عضو
5. **تعیین دسترسی** به فرم‌های مورد نظر

---

## 📞 پشتیبانی و منابع

### مستندات تکمیلی:
- `DOCUMENTATION.md` - راهنمای توسعه‌دهنده
- `USER_GUIDE.md` - راهنمای کاربری تفصیلی  
- `TECHNICAL_ANALYSIS.md` - تحلیل فنی پروژه
- `AI_CAPABILITIES.md` - راهنمای هوش مصنوعی

### اطلاعات پروژه:
- **نسخه فعلی**: 6.4.5
- **سازگاری وردپرس**: 5.0+
- **نیازمندی PHP**: 7.4+
- **مجوز**: GPL2

### ارتباط با توسعه‌دهندگان:
- **وب‌سایت**: [arshline.ir](https://arshline.ir/)
- **ایمیل پشتیبانی**: support@arshline.ir
- **مستندات آنلاین**: docs.arshline.ir

---

**© ۱۴۰۳ گروه توسعه عرشلاین | تمام حقوق محفوظ است**